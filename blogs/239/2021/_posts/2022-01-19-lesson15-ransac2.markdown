---
layout: ru/blogs/239/2021/post
title:  "Урок 15: построение прямой через точки - RANSAC"
date:   2022-01-19 00:02:00 +0300
lang:   ru
categories: school239_11_2021_2022
---

[Предыдущая статья.](/blogs/239/2021/school239_11_2021_2022/2022/01/11/lesson14-ransac1-line-from-points.html)

Итак, что делать если у нас есть сколько-то корректных (**inliers**, хоть они и могут быть шумными) точек с прямой, и сколько-то выбросов (**outliers**) - точек которые не имеют никакого отношения к прямой?

![Random points](/static/2022/01/test1_4random_points.png)

Для такой задачи есть очень широко применяемый подход - [RANSAC](https://en.wikipedia.org/wiki/Random_sample_consensus) (**RAN**dom **SA**mple **C**onsensus = консенсус через случайные гипотезы).

Идея такая - пусть мы хотим найти некоторый ответ (в данном случае прямую) по некоторому набору данных которые должны этому ответу подходить (в данном случае точки должены лежать на прямой-ответе).

Какой критерий качества нашего ответа? Т.е. насколько нам кажется прямая "правильной" для данного множества точек? Можно было бы считать среднее расстояние, но оно будет слишком сильно колебаться от выбросов - точек не имеющих отношения к прямой.

Давайте считать число точек которые находятся от прямой на каком-то разумном расстоянии, например не дальше чем на расстоянии 10 пикселей. Такая метрика устойчива к выбросам - они просто не будут засчитаны! Т.е. иначе говоря мы ищем прямую которая (с некоторой допустимой погрешностью) проходит через наибольшее число точек.

Тогда можно использовать следующий **RANSAC** алгоритм который по множеству точек найдет наиболее подходящую прямую:

1) Берем две случайные точки из нашего множества

2) Строим по этим точкам прямую A

3) Считаем число поддерживающих эту прямую точек (т.е. по сути число голосов за эту прямую, иначе говоря - число корректных замеров - т.е. количество **inliers**)

4) Повторяем шаги 1-3 например тысячу раз, а как ответ выдаем прямую с наибольшим числом голосов (т.е. с наибольшим числом **inliers**)

Интуиция в том что если даже корректных (**inliers**) точек с прямой всего лишь 10% (т.е. выбросов, **outliers** - 90%), то шансов угадать пару **inliers**-точек которые задают истинную прямую = 10% * 10% = 1%, а значит тысячи случайных угадываний должно быть достаточно.
